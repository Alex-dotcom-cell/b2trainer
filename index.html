<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>B2 German Exam Trainer ‚Äî Premium TTS</title>

  <!-- Tailwind CDN (simple) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React & ReactDOM (UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel for JSX in-browser (single-file convenience) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    .btn-icon { width: 2.25rem; height: 2.25rem; display: inline-flex; align-items:center; justify-content:center; border-radius: 9999px; }
    .card { background: white; border: 1px solid rgba(15,23,42,0.06); border-radius: 12px; padding: 1rem; box-shadow: 0 6px 20px rgba(2,6,23,0.04); }
    pre { white-space: pre-wrap; word-break: break-word; }
    .debug-panel { background: #1a1a1a; color: #00ff00; padding: 10px; border-radius: 8px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; }
    .status-good { color: #10B981; }
    .status-bad { color: #EF4444; }
    .fade-in { animation: fadeIn 0.3s ease-in; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .pulse { animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
  </style>
</head>
<body class="bg-gray-50 p-6">

  <div id="root" class="max-w-6xl mx-auto"></div>

  <script type="text/babel">
  // B2 Trainer ‚Äî Single-file React app (Pro style, ElevenLabs TTS + fallback)
  const { useState, useEffect, useMemo, useCallback, useRef } = React;

  /* ----------------------------
     === CONFIG ===
     ---------------------------- */
  const ELEVEN_LABS_CONFIG = {
    API_KEY: "sk_d16c6996ff71066a5da550247033cec8d72ab9e8ac821c45",
    VOICE_ID: "21m00Tcm4TlvDq8ikWAM", // Rachel - –∂–µ–Ω—Å–∫–∏–π –≥–æ–ª–æ—Å
    API_URL: "https://api.elevenlabs.io/v1/text-to-speech"
  };

  /* ----------------------------
     === DATA (Schreiben & Sprechen) ===
     ---------------------------- */

  const SCHREIBEN_TOPICS = [
    { id: 'produkt', ru: '1. –¢–æ–≤–∞—Ä (–¥–µ—Ñ–µ–∫—Ç)', de: 'der neue Staubsauger' },
    { id: 'service', ru: '2. –£—Å–ª—É–≥–∞ (–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ)', de: 'Ihr Internetanschluss' },
    { id: 'kurs', ru: '3. –ö—É—Ä—Å/–®–∫–æ–ª–∞ (–Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏)', de: 'der Deutsch B2-Kurs' },
    { id: 'reise', ru: '4. –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ/–û—Ç–µ–ª—å (–Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏)', de: 'das gebuchte Hotelzimmer' },
    { id: 'wohnung', ru: '5. –î–µ—Ñ–µ–∫—Ç –≤ –∫–≤–∞—Ä—Ç–∏—Ä–µ', de: 'die Heizungsanlage in meiner Wohnung' },
    { id: 'rechnung', ru: '6. –°—á–µ—Ç/–î–æ–≥–æ–≤–æ—Ä (–æ—à–∏–±–∫–∞)', de: 'meine letzte Rechnung' },
    { id: 'transport', ru: '7. –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç (–∑–∞–¥–µ—Ä–∂–∫–∞/–ø—Ä–æ–±–ª–µ–º–∞)', de: 'die Bahnverbindung nach Berlin' },
  ];

  const PHRASES_DATA = {
    greetings: [ { id: 101, text: "Sehr geehrte Damen und Herren,", ru: "–£–≤–∞–∂–∞–µ–º—ã–µ –¥–∞–º—ã –∏ –≥–æ—Å–ø–æ–¥–∞,", tip: "–§–æ—Ä–º–∞–ª—å–Ω–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ." } ],
    issue_intro: [
      { id: 201, text: "Ich schreibe Ihnen bez√ºglich [–æ–±—ä–µ–∫—Ç –∂–∞–ª–æ–±—ã].", ru: "–Ø –ø–∏—à—É –í–∞–º –ø–æ –ø–æ–≤–æ–¥—É [–æ–±—ä–µ–∫—Ç –∂–∞–ª–æ–±—ã].", tip: "–ü—Ä–µ–¥–ª–æ–≥ 'bez√ºglich' ‚Äî Genitiv." },
      { id: 202, text: "Ich beziehe mich auf unsere Bestellung/Vereinbarung vom [–î–∞—Ç–∞].", ru: "–Ø —Å—Å—ã–ª–∞—é—Å—å –Ω–∞ –Ω–∞—à –∑–∞–∫–∞–∑/–¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –æ—Ç [–î–∞—Ç–∞].", tip: "sich beziehen auf + Akk." }
    ],
    main_problem: [
      { id: 301, text: "Leider muss ich Ihnen mitteilen, dass [–æ–±—ä–µ–∫—Ç –∂–∞–ª–æ–±—ã] nicht der Beschreibung entspricht.", ru: "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, [–æ–±—ä–µ–∫—Ç –∂–∞–ª–æ–±—ã] –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—é.", tip: "–ü—Ä–∏–¥–∞—Ç–æ—á–Ω–æ–µ —Å 'dass' ‚Äî –≥–ª–∞–≥–æ–ª –≤ –∫–æ–Ω—Ü–µ." },
      { id: 302, text: "Der Hauptgrund f√ºr meine Beschwerde ist, dass es M√§ngel gibt.", ru: "–ü—Ä–∏—á–∏–Ω–∞ –∂–∞–ª–æ–±—ã ‚Äî –Ω–∞–ª–∏—á–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤.", tip: "M√§ngel ‚Äî –º–Ω. —á–∏—Å–ª–æ." }
    ],
    problem_consequence: [
      { id: 401, text: "Aufgrund dieses Problems konnte ich meine Arbeit nicht wie geplant durchf√ºhren.", ru: "–ò–∑-–∑–∞ —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã —è –Ω–µ —Å–º–æ–≥ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–∞–±–æ—Ç—É –∫–∞–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–ª.", tip: "Aufgrund + Genitiv." },
      { id: 402, text: "Das hat bei mir zu gro√üem √Ñrger und Unannehmlichkeiten gef√ºhrt.", ru: "–≠—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ –±–æ–ª—å—à–∏–º –Ω–µ—É–¥–æ–±—Å—Ç–≤–∞–º.", tip: "–£—Å—Ç–æ–π—á–∏–≤—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è." }
    ],
    evidence: [
      { id: 501, text: "Ich habe Ihnen alle notwendigen Unterlagen in der Anlage beigef√ºgt.", ru: "–Ø –ø—Ä–∏–ª–æ–∂–∏–ª –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã.", tip: "beif√ºgen ‚Äî Perfekt: habe beigef√ºgt." },
      { id: 502, text: "Ich m√∂chte Sie bitten, die Angelegenheit innerhalb von 14 Tagen zu kl√§ren.", ru: "–ü—Ä–æ—à—É —Ä–µ—à–∏—Ç—å –≤–æ–ø—Ä–æ—Å –≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π.", tip: "Infinitivkonstruktion mit 'zu'." }
    ],
    resolution_request: [
      { id: 601, text: "Daher bitte ich Sie h√∂flich um eine schnelle L√∂sung und um Ersatz.", ru: "–ü—Ä–æ—à—É —Å—Ä–æ—á–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –∏ –∑–∞–º–µ–Ω—ã.", tip: "Daher ‚Äî —Å–ª–µ–¥—Å—Ç–≤–∏–µ." },
      { id: 602, text: "Falls dies nicht m√∂glich ist, erwarte ich die volle R√ºckerstattung des Kaufpreises.", ru: "–ï—Å–ª–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ ‚Äî –æ–∂–∏–¥–∞—é –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å—Ä–µ–¥—Å—Ç–≤.", tip: "Falls = –µ—Å–ª–∏." }
    ],
    closing_formula: [ { id: 701, text: "Ich danke Ihnen f√ºr Ihre M√ºhe und hoffe auf eine schnelle Kl√§rung.", ru: "–ë–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –≤–Ω–∏–º–∞–Ω–∏–µ –∏ –Ω–∞–¥–µ—é—Å—å –Ω–∞ –±—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ.", tip: "–°–ø–∞—Å–∏–±–æ + –Ω–∞–¥–µ–∂–¥–∞." } ],
    sign_off: [ { id: 801, text: "Mit freundlichen Gr√º√üen,", ru: "–° —É–≤–∞–∂–µ–Ω–∏–µ–º,", tip: "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø–æ–¥–ø–∏—Å—å." } ],
  };

  const SPRECHEN_SCENARIOS = [
    {
      id: 'thema1',
      title_ru: '–¢–µ–º–∞ 1: –û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è',
      title_de: 'Thema 1: Arbeitgeber beschreiben',
      dialogues: [
        {
          id: '1a',
          title_ru: 'A. –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è IT-–∫–æ–º–ø–∞–Ω–∏—è',
          text_de: `A: Ich m√∂chte √ºber einen Arbeitgeber sprechen, bei dem ich gerne arbeiten w√ºrde ‚Äì ein internationales IT-Unternehmen.
B: Klingt spannend. In welcher Branche ist das Unternehmen t√§tig?
A: Es entwickelt Softwarel√∂sungen f√ºr gro√üe Firmen, zum Beispiel f√ºr Banken und Versicherungen.
B: Und welche Abteilungen gibt es dort?
A: Es gibt eine Entwicklungsabteilung, ein Marketingteam, den Kundenservice und die Personalabteilung.`,
          text_ru: `A: –Ø —Ö–æ—á—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ ‚Äî –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–π IT-–∫–æ–º–ø–∞–Ω–∏–∏.
B: –í –∫–∞–∫–æ–π –æ—Ç—Ä–∞—Å–ª–∏ –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç?
A: –û–Ω–∞ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ü–û –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π.
B: –ö–∞–∫–∏–µ –æ—Ç–¥–µ–ª—ã —Ç–∞–º –µ—Å—Ç—å?
A: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞, –º–∞—Ä–∫–µ—Ç–∏–Ω–≥, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ HR.`
        },
        {
          id: '1b',
          title_ru: 'B. –ö–æ–º–ø–∞–Ω–∏—è —Å —Ö–æ—Ä–æ—à–∏–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏ —Ç—Ä—É–¥–∞',
          text_de: `A: Ich kenne ein Unternehmen, das ein sehr gutes Arbeitsumfeld bietet ‚Äì es ist ein mittelst√§ndisches Familienunternehmen.
B: Was macht das Arbeitsumfeld dort so gut?
A: Die Atmosph√§re ist freundlich und respektvoll. Die Mitarbeiter arbeiten gern zusammen.
B: Und wie sieht es mit dem Gehalt aus?
A: Die L√∂hne sind fair und es gibt regelm√§√üige Gehaltserh√∂hungen.
B: Gibt es auch Karrierechancen?
A: Ja, man kann sich intern weiterentwickeln und bekommt Unterst√ºtzung bei Fortbildungen.`,
          text_ru: `A: –Ø –∑–Ω–∞—é –∫–æ–º–ø–∞–Ω–∏—é —Å –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–∏–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏ —Ç—Ä—É–¥–∞ ‚Äî —ç—Ç–æ —Å—Ä–µ–¥–Ω—è—è —Å–µ–º–µ–π–Ω–∞—è —Ñ–∏—Ä–º–∞.
B: –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —É—Å–ª–æ–≤–∏—è —Ç—Ä—É–¥–∞ —Ç–∞–º —Ç–∞–∫–∏–º–∏ —Ö–æ—Ä–æ—à–∏–º–∏?
A: –ê—Ç–º–æ—Å—Ñ–µ—Ä–∞ –¥—Ä—É–∂–µ–ª—é–±–Ω–∞—è –∏ —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–∞—è. –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –æ—Ö–æ—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ.
B: –ê –∫–∞–∫ –æ–±—Å—Ç–æ—è—Ç –¥–µ–ª–∞ —Å –∑–∞—Ä–ø–ª–∞—Ç–æ–π?
A: –ó–∞—Ä–ø–ª–∞—Ç—ã —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–µ, –∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –ø–æ–≤—ã—à–µ–Ω–∏—è.
B: –ï—Å—Ç—å –ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∫–∞—Ä—å–µ—Ä–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞?
A: –î–∞, –º–æ–∂–Ω–æ —Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–ø–∞–Ω–∏–∏ –∏ –ø–æ–ª—É—á–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤ –æ–±—É—á–µ–Ω–∏–∏.`
        }
      ]
    },
    {
      id: 'thema2',
      title_ru: '–¢–µ–º–∞ 2: –°–æ–±—ã—Ç–∏—è –∏ –æ–ø—ã—Ç, –ø–æ–≤–ª–∏—è–≤—à–∏–µ –Ω–∞ –≤—ã–±–æ—Ä –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏',
      title_de: 'Thema 2: Ereignisse und Erfahrungen, die Ihre Berufswahl beeinflusst haben',
      dialogues: [
        {
          id: '2a',
          title_ru: 'A. –î–µ—Ç—Å–∫–∏–π –∏–Ω—Ç–µ—Ä–µ—Å –∫ —Ç–µ—Ö–Ω–∏–∫–µ',
          text_de: `A: Ich habe mich f√ºr meinen Beruf entschieden, weil ich schon als Kind gro√ües Interesse an Technik hatte.
B: Das ist spannend. Gab es ein besonderes Erlebnis, das dich beeinflusst hat?
A: Ja, ich habe in der Schule ein Projekt gemacht, bei dem wir einen kleinen Roboter gebaut haben.
B: Klingt cool! Hat dir das Projekt Spa√ü gemacht?
A: Sehr! Ich habe gemerkt, dass ich kreativ bin und gerne Probleme l√∂se.
B: Hast du auch ein Praktikum gemacht?
A: Ja, ich war zwei Wochen in einem IT-Unternehmen. Ich durfte bei echten Projekten mitarbeiten.`,
          text_ru: `A: –Ø –≤—ã–±—Ä–∞–ª —Å–≤–æ—é –ø—Ä–æ—Ñ–µ—Å—Å–∏—é, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å –¥–µ—Ç—Å—Ç–≤–∞ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–ª—Å—è —Ç–µ—Ö–Ω–∏–∫–æ–π.
B: –≠—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ. –ë—ã–ª–æ –ª–∏ –∫–∞–∫–æ–µ-—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω–∞ —Ç–µ–±—è –ø–æ–≤–ª–∏—è–ª–æ?
A: –î–∞, –≤ —à–∫–æ–ª–µ —è —É—á–∞—Å—Ç–≤–æ–≤–∞–ª –≤ –ø—Ä–æ–µ–∫—Ç–µ, –≥–¥–µ –º—ã —Å–æ–±–∏—Ä–∞–ª–∏ –º–∞–ª–µ–Ω—å–∫–æ–≥–æ —Ä–æ–±–æ—Ç–∞.
B: –ó–≤—É—á–∏—Ç –∫—Ä—É—Ç–æ! –¢–µ–±–µ –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç?
A: –û—á–µ–Ω—å! –Ø –ø–æ–Ω—è–ª, —á—Ç–æ —è –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π –∏ –ª—é–±–ª—é —Ä–µ—à–∞—Ç—å –∑–∞–¥–∞—á–∏.
B: –¢—ã –ø—Ä–æ—Ö–æ–¥–∏–ª –ø—Ä–∞–∫—Ç–∏–∫—É?
A: –î–∞, —è –±—ã–ª –¥–≤–µ –Ω–µ–¥–µ–ª–∏ –≤ IT-–∫–æ–º–ø–∞–Ω–∏–∏. –ú–Ω–µ —Ä–∞–∑—Ä–µ—à–∏–ª–∏ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.`
        }
      ]
    },
    {
      id: 'thema3',
      title_ru: '–¢–µ–º–∞ 3: –ß–µ–ª–æ–≤–µ–∫, –ø–æ–≤–ª–∏—è–≤—à–∏–π –Ω–∞ –≤—ã–±–æ—Ä –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏',
      title_de: 'Thema 3: Eine Person, die Ihre Berufswahl beeinflusst hat',
      dialogues: [
        {
          id: '3a',
          title_ru: 'A. –í–ª–∏—è–Ω–∏–µ —Å—Ç–∞—Ä—à–µ–≥–æ –±—Ä–∞—Ç–∞',
          text_de: `A: Ich m√∂chte √ºber meinen √§lteren Bruder sprechen. Er hat meine Berufswahl stark beeinflusst.
B: Interessant! Was macht dein Bruder beruflich?
A: Er ist Grafikdesigner in einer Werbeagentur. Schon als Kind hat he viel gezeichnet und war sehr kreativ.
B: Und wie hat er dich beeinflusst?
A: Er hat mir gezeigt, wie spannend kreative Berufe sein k√∂nnen. Ich habe durch ihn angefangen, mit Designprogrammen zu arbeiten.
B: Habt ihr auch gemeinsam Projekte gemacht?
A: Ja, wir haben zusammen ein Logo f√ºr ein Schulprojekt entworfen. Das hat mir gro√üen Spa√ü gemacht.`,
          text_ru: `A: –Ø —Ö–æ—á—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ —Å–≤–æ–µ–º —Å—Ç–∞—Ä—à–µ–º –±—Ä–∞—Ç–µ. –û–Ω —Å–∏–ª—å–Ω–æ –ø–æ–≤–ª–∏—è–ª –Ω–∞ –º–æ–π –≤—ã–±–æ—Ä –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏.
B: –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ! –ö–µ–º —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–≤–æ–π –±—Ä–∞—Ç?
A: –û–Ω –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω–µ—Ä –≤ —Ä–µ–∫–ª–∞–º–Ω–æ–º –∞–≥–µ–Ω—Ç—Å—Ç–≤–µ. –ï—â–µ –≤ –¥–µ—Ç—Å—Ç–≤–µ –æ–Ω –º–Ω–æ–≥–æ —Ä–∏—Å–æ–≤–∞–ª –∏ –±—ã–ª –æ—á–µ–Ω—å –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–º.
B: –ê –∫–∞–∫ –æ–Ω –ø–æ–≤–ª–∏—è–ª –Ω–∞ —Ç–µ–±—è?
A: –û–Ω –ø–æ–∫–∞–∑–∞–ª –º–Ω–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏. –ë–ª–∞–≥–æ–¥–∞—Ä—è –µ–º—É —è –Ω–∞—á–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏–º–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º–∏.
B: –í—ã –¥–µ–ª–∞–ª–∏ —Å–æ–≤–º–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã?
A: –î–∞, –º—ã –≤–º–µ—Å—Ç–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–ª–∏ –ª–æ–≥–æ—Ç–∏–ø –¥–ª—è —à–∫–æ–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞. –≠—Ç–æ –¥–æ—Å—Ç–∞–≤–∏–ª–æ –º–Ω–µ –±–æ–ª—å—à–æ–µ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ.`
        }
      ]
    },
    {
      id: 'thema4',
      title_ru: '–¢–µ–º–∞ 4: –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç—ã –≤ –¥—Ä—É–≥–æ–π —Å—Ç—Ä–∞–Ω–µ',
      title_de: 'Thema 4: Arbeitssuche in einem Land Ihrer Wahl',
      dialogues: [
        {
          id: '4a',
          title_ru: 'A. –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç—ã –≤ –ì–µ—Ä–º–∞–Ω–∏–∏',
          text_de: `A: Ich m√∂chte √ºber die Arbeitssuche in Deutschland sprechen.
B: Okay. Wie beginnt man dort mit der Jobsuche?
A: Zuerst sucht man online nach Stellenangeboten ‚Äì zum Beispiel auf Webseiten wie StepStone oder Indeed.
B: Und was macht man, wenn man ein interessantes Angebot findet?
A: Man sollte sich gut √ºber die Firma informieren und dann eine Bewerbung schreiben.
B: Was geh√∂rt zu einer Bewerbung in Deutschland?
A: Ein Lebenslauf, ein Anschreiben und oft auch Zeugnisse oder Zertifikate.
B: Und wie l√§uft der Erstkontakt ab?
A: Man schickt die Bewerbung per E-Mail oder √ºber ein Online-Formular. Danach bekommt man eine Antwort.`,
          text_ru: `A: –Ø —Ö–æ—á—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ –ø–æ–∏—Å–∫–µ —Ä–∞–±–æ—Ç—ã –≤ –ì–µ—Ä–º–∞–Ω–∏–∏.
B: –•–æ—Ä–æ—à–æ. –° —á–µ–≥–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç—ã —Ç–∞–º?
A: –°–Ω–∞—á–∞–ª–∞ –∏—â—É—Ç –≤–∞–∫–∞–Ω—Å–∏–∏ –æ–Ω–ª–∞–π–Ω ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ —Å–∞–π—Ç–∞—Ö –≤—Ä–æ–¥–µ StepStone –∏–ª–∏ Indeed.
B: –ê —á—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –≤–∞–∫–∞–Ω—Å–∏—è?
A: –ù—É–∂–Ω–æ —Ö–æ—Ä–æ—à–æ —É–∑–Ω–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏ –∏ –∑–∞—Ç–µ–º –Ω–∞–ø–∏—Å–∞—Ç—å –∑–∞—è–≤–ª–µ–Ω–∏–µ.
B: –ß—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ –∑–∞—è–≤–ª–µ–Ω–∏–µ –æ –ø—Ä–∏–µ–º–µ –Ω–∞ —Ä–∞–±–æ—Ç—É –≤ –ì–µ—Ä–º–∞–Ω–∏–∏?
A: –†–µ–∑—é–º–µ, —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ –∏ —á–∞—Å—Ç–æ ‚Äî –¥–∏–ø–ª–æ–º—ã –∏–ª–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã.
B: –ê –∫–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç?
A: –ó–∞—è–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç–µ –∏–ª–∏ —á–µ—Ä–µ–∑ –æ–Ω–ª–∞–π–Ω-—Ñ–æ—Ä–º—É. –ó–∞—Ç–µ–º –ø—Ä–∏—Ö–æ–¥–∏—Ç –æ—Ç–≤–µ—Ç.`
        }
      ]
    },
    {
      id: 'thema5',
      title_ru: '–¢–µ–º–∞ 5: –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–∫–∏',
      title_de: 'Thema 5: Worauf es bei einem Bewerbungsprozess ankommt',
      dialogues: [
        {
          id: '5a',
          title_ru: 'A. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—é',
          text_de: `A: Ich finde, ein erfolgreicher Bewerbungsprozess beginnt mit einer guten Vorbereitung.
B: Da stimme ich dir zu. Man sollte sich zuerst √ºber das Unternehmen informieren.
A: Genau. Man sollte wissen, was die Firma macht, welche Werte sie hat und welche Anforderungen sie stellt.
B: Und dann kommt der Lebenslauf. Der muss klar und √ºbersichtlich sein.
A: Ja, und man sollte relevante Erfahrungen und F√§higkeiten betonen.
B: Was ist mit dem Anschreiben?
A: Das ist sehr wichtig. Es sollte pers√∂nlich sein und zeigen, warum man sich gerade f√ºr diese Stelle interessiert.`,
          text_ru: `A: –Ø —Å—á–∏—Ç–∞—é, —á—Ç–æ —É—Å–ø–µ—à–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–∫–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —Ö–æ—Ä–æ—à–µ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏.
B: –°–æ–≥–ª–∞—Å–µ–Ω —Å —Ç–æ–±–æ–π. –°–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ —É–∑–Ω–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏.
A: –ò–º–µ–Ω–Ω–æ. –ù—É–∂–Ω–æ –∑–Ω–∞—Ç—å, —á–µ–º –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Ñ–∏—Ä–º–∞, –∫–∞–∫–∏–µ —É –Ω–µ—ë —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –∫–∞–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –æ–Ω–∞ –ø—Ä–µ–¥—ä—è–≤–ª—è–µ—Ç.
B: –ê –∑–∞—Ç–µ–º –∏–¥—ë—Ç —Ä–µ–∑—é–º–µ. –û–Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á—ë—Ç–∫–∏–º –∏ –ø–æ–Ω—è—Ç–Ω—ã–º.
A: –î–∞, –∏ –Ω—É–∂–Ω–æ –ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –æ–ø—ã—Ç –∏ –Ω–∞–≤—ã–∫–∏.
B: –ê –∫–∞–∫ –Ω–∞—Å—á—ë—Ç —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–∏—Å—å–º–∞?
A: –≠—Ç–æ –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ. –û–Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ª–∏—á–Ω—ã–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å, –ø–æ—á–µ–º—É —Ç—ã –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω –∏–º–µ–Ω–Ω–æ –≤ —ç—Ç–æ–π –¥–æ–ª–∂–Ω–æ—Å—Ç–∏.`
        }
      ]
    },
    {
      id: 'thema6',
      title_ru: '–¢–µ–º–∞ 6: –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ –∏–ª–∏ —É—Å–ª—É–≥–∏',
      title_de: 'Thema 6: Ein Produkt / eine Dienstleistung Ihrer Wahl',
      dialogues: [
        {
          id: '6a',
          title_ru: 'A. –ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã–µ –Ω–∞—É—à–Ω–∏–∫–∏',
          text_de: `A: Ich m√∂chte ein Produkt beschreiben, das ich t√§glich benutze ‚Äì meine kabellosen Kopfh√∂rer.
B: Interessant! Was sind die wichtigsten Merkmale?
A: Sie sind leicht, haben eine gute Klangqualit√§t und eine lange Akkulaufzeit ‚Äì bis zu 30 Stunden.
B: Und wie funktioniert die Verbindung?
A: √úber Bluetooth. Die Verbindung ist stabil und funktioniert auch mit mehreren Ger√§ten.
B: Was ist der Nutzen f√ºr die Kunden?
A: Man kann Musik h√∂ren, telefonieren oder Podcasts h√∂ren ‚Äì alles ohne Kabel.
B: Gibt es auch Nachteile?
A: Ja, sie sind teurer als kabelgebundene Kopfh√∂rer und man muss sie regelm√§√üig aufladen.`,
          text_ru: `A: –Ø —Ö–æ—á—É –æ–ø–∏—Å–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É—é –∫–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –º–æ–∏ –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã–µ –Ω–∞—É—à–Ω–∏–∫–∏.
B: –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ! –ö–∞–∫–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏?
A: –û–Ω–∏ –ª—ë–≥–∫–∏–µ, –∏–º–µ—é—Ç —Ö–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞ –∏ –¥–æ–ª–≥–æ –¥–µ—Ä–∂–∞—Ç –∑–∞—Ä—è–¥ ‚Äî –¥–æ 30 —á–∞—Å–æ–≤.
B: –ê –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ?
A: –ß–µ—Ä–µ–∑ Bluetooth. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏.
B: –ö–∞–∫–æ–≤–∞ –ø–æ–ª—å–∑–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤?
A: –ú–æ–∂–Ω–æ —Å–ª—É—à–∞—Ç—å –º—É–∑—ã–∫—É, —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—Ç—å –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏–ª–∏ —Å–ª—É—à–∞—Ç—å –ø–æ–¥–∫–∞—Å—Ç—ã ‚Äî –≤—Å—ë –±–µ–∑ –ø—Ä–æ–≤–æ–¥–æ–≤.
B: –ï—Å—Ç—å –ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏?
A: –î–∞, –æ–Ω–∏ –¥–æ—Ä–æ–∂–µ, —á–µ–º –ø—Ä–æ–≤–æ–¥–Ω—ã–µ –Ω–∞—É—à–Ω–∏–∫–∏, –∏ –∏—Ö –Ω—É–∂–Ω–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –∑–∞—Ä—è–∂–∞—Ç—å.`
        }
      ]
    }
  ];

  const initialActiveScenario = SPRECHEN_SCENARIOS[0];

  /* ----------------------------
     === UTILS: TTS & audio helpers ===
     ---------------------------- */

  // –ö—ç—à –¥–ª—è TTS –∞—É–¥–∏–æ
  const ttsCache = new Map();
  let lastRequestTime = 0;

  // ElevenLabs TTS function - –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
  async function callElevenLabsTTS(text, voice_id = ELEVEN_LABS_CONFIG.VOICE_ID) {
    const apiKey = ELEVEN_LABS_CONFIG.API_KEY;
    
    if (!apiKey) {
      throw new Error("‚ùå ElevenLabs API key missing");
    }

    console.log("üîß Sending to ElevenLabs:", text);

    try {
      const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voice_id}`, {
        method: "POST",
        headers: {
          "Accept": "audio/mpeg",
          "Content-Type": "application/json",
          "xi-api-key": apiKey
        },
        body: JSON.stringify({
          text: text,
          model_id: "eleven_multilingual_v2",
          voice_settings: {
            stability: 0.5,
            similarity_boost: 0.5
          }
        })
      });

      console.log("üì° ElevenLabs status:", response.status);

      if (!response.ok) {
        let errorText = "Unknown error";
        try {
          errorText = await response.text();
        } catch (e) {}
        
        console.error("‚ùå ElevenLabs error:", response.status, errorText);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ API
        if (response.status === 401) {
          throw new Error("–ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á ElevenLabs");
        } else if (response.status === 429) {
          throw new Error("–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ ElevenLabs");
        } else {
          throw new Error(`ElevenLabs error: ${response.status}`);
        }
      }

      const audioBlob = await response.blob();
      console.log("‚úÖ ElevenLabs audio blob type:", audioBlob.type, "size:", audioBlob.size, "bytes");
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø blob
      if (audioBlob.size === 0) {
        throw new Error("–ü—É—Å—Ç–æ–π –∞—É–¥–∏–æ—Ñ–∞–π–ª –æ—Ç ElevenLabs");
      }
      
      const audioUrl = URL.createObjectURL(audioBlob);
      return { url: audioUrl };
      
    } catch (error) {
      console.error("üí• ElevenLabs failed:", error);
      throw error;
    }
  }

  // Fallback: Web Speech API
  function speakWithWebSpeech(text, lang = "de-DE") {
    return new Promise((resolve, reject) => {
      if (!("speechSynthesis" in window)) {
        return reject(new Error("SpeechSynthesis not supported"));
      }
      
      // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –≥–æ–ª–æ—Å–æ–≤
      if (window.speechSynthesis.getVoices().length === 0) {
        window.speechSynthesis.addEventListener('voiceschanged', () => {
          speakWithWebSpeech(text, lang).then(resolve).catch(reject);
        });
        return;
      }
      
      window.speechSynthesis.cancel();
      
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = lang;
      utterance.rate = 0.8; // –ú–µ–¥–ª–µ–Ω–Ω–µ–µ –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è
      utterance.pitch = 1.0;
      utterance.volume = 1.0;
      
      // –ò—â–µ–º –Ω–µ–º–µ—Ü–∫–∏–π –≥–æ–ª–æ—Å
      const voices = window.speechSynthesis.getVoices();
      const germanVoice = voices.find(voice => 
        voice.lang.includes('de') || voice.lang === 'de-DE' || voice.lang === 'de'
      );
      
      if (germanVoice) {
        utterance.voice = germanVoice;
        console.log("‚úÖ Using German voice:", germanVoice.name);
      } else {
        console.log("‚ö†Ô∏è No German voice found, using default");
      }
      
      utterance.onend = () => {
        console.log("‚úÖ Web Speech finished");
        resolve();
      };
      
      utterance.onerror = (e) => {
        console.error("‚ùå Web Speech error:", e);
        reject(new Error(`Speech error: ${e.error}`));
      };
      
      console.log("üîä Starting Web Speech...");
      window.speechSynthesis.speak(utterance);
    });
  }

  /* ----------------------------
     === UI: small icons as SVG strings ===
     ---------------------------- */
  const Icon = {
    Volume: (props) => (
      <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" strokeWidth="1.6" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
        <path d="M19 5c.4 1.1.5 2.3.5 3.5s-.1 2.4-.5 3.5"></path>
        <path d="M15 9.5c.3.8.5 1.7.5 2.5s-.2 1.7-.5 2.5"></path>
      </svg>
    ),
    Refresh: (props) => (
      <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" strokeWidth="1.6" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="M21 12a9 9 0 1 0-3.2 6.7L21 18"></path>
        <path d="M21 12v6h-6"></path>
      </svg>
    ),
    Loader: (props) => (
      <svg viewBox="0 0 24 24" width="16" height="16" className="animate-spin" {...props}>
        <circle cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="2" fill="none" strokeDasharray="31.4 31.4" strokeLinecap="round"></circle>
      </svg>
    ),
    Bug: (props) => (
      <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" strokeWidth="1.6" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="M8 2v2M16 2v2M12 2v4M12 18v4M8 22h8M18 8h2M4 8h2M18 8v4a6 6 0 0 1-6 6h0a6 6 0 0 1-6-6V8M4 8h16"></path>
      </svg>
    ),
    Check: (props) => (
      <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="M20 6L9 17l-5-5"></path>
      </svg>
    ),
    Star: (props) => (
      <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" stroke="currentColor" strokeWidth="1" {...props}>
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>
    )
  };

  /* ----------------------------
     === React App ===
     ---------------------------- */

  function App() {
    const [view, setView] = useState('schreiben');
    const [selections, setSelections] = useState(useMemo(() => ({
      greetings: PHRASES_DATA.greetings[0].id,
      issue_intro: PHRASES_DATA.issue_intro[0].id,
      main_problem: PHRASES_DATA.main_problem[0].id,
      problem_consequence: PHRASES_DATA.problem_consequence[0].id,
      evidence: PHRASES_DATA.evidence[0].id,
      resolution_request: PHRASES_DATA.resolution_request[0].id,
      closing_formula: PHRASES_DATA.closing_formula[0].id,
      sign_off: PHRASES_DATA.sign_off[0].id,
    }), []));
    const [activeTopic, setActiveTopic] = useState(SCHREIBEN_TOPICS[0]);
    const [senderName, setSenderName] = useState("Ivan Ivanov");
    const [invoiceNumber, setInvoiceNumber] = useState("RE-2024-5829");
    const [currentDate] = useState(new Date().toLocaleDateString('de-DE'));
    const [activeScenario, setActiveScenario] = useState(initialActiveScenario);
    const [activeDialogue, setActiveDialogue] = useState(initialActiveScenario.dialogues[0]);
    const [audioUrl, setAudioUrl] = useState(null);
    const [isLoading, setIsLoading] = useState(false);
    const [error, setError] = useState(null);
    const [debugLog, setDebugLog] = useState([]);
    const [showDebug, setShowDebug] = useState(false);
    const [ttsStatus, setTtsStatus] = useState("unknown");
    const [progress, setProgress] = useState(0);
    const [completedSections, setCompletedSections] = useState(new Set());
    const [premiumMode, setPremiumMode] = useState(false);
    const audioRef = useRef(null);

    const addDebugLog = (message, type = "info") => {
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = `${timestamp}: ${message}`;
      console.log(`[${type.toUpperCase()}] ${logEntry}`);
      setDebugLog(prev => [...prev, {message: logEntry, type}].slice(-20));
    };

    const allPhrases = useMemo(() => Object.values(PHRASES_DATA).flat(), []);
    const findPhraseById = useCallback((id) => allPhrases.find(p => p.id === id), [allPhrases]);

    const replacePlaceholder = useCallback((text) => {
      if (!text) return '';
      return text.replace(/\[–æ–±—ä–µ–∫—Ç –∂–∞–ª–æ–±—ã\]/g, activeTopic.de).replace(/\[–î–∞—Ç–∞\]/g, currentDate);
    }, [activeTopic, currentDate]);

    const assembleLetterText = useCallback(() => {
      const parts = [
        replacePlaceholder(findPhraseById(selections.greetings)?.text || ''),
        replacePlaceholder(findPhraseById(selections.issue_intro)?.text || ''),
        replacePlaceholder(findPhraseById(selections.main_problem)?.text || ''),
        replacePlaceholder(findPhraseById(selections.problem_consequence)?.text || ''),
        replacePlaceholder(findPhraseById(selections.evidence)?.text || ''),
        replacePlaceholder(findPhraseById(selections.resolution_request)?.text || ''),
        replacePlaceholder(findPhraseById(selections.closing_formula)?.text || ''),
        replacePlaceholder(findPhraseById(selections.sign_off)?.text || ''),
        senderName
      ];
      return parts.filter(Boolean).join("\n\n");
    }, [selections, activeTopic, currentDate, senderName, findPhraseById, replacePlaceholder]);

    const speakText = async (text) => {
      setError(null);
      if (!text || text.trim().length === 0) return;
      
      setIsLoading(true);
      setAudioUrl(null);

      addDebugLog(`üîä START: "${text.substring(0, 30)}..."`, "info");

      // üî• –ü–†–ï–ú–ò–£–ú –†–ï–ñ–ò–ú: —Å–Ω–∞—á–∞–ª–∞ ElevenLabs
      if (premiumMode) {
        addDebugLog("üéµ PREMIUM MODE: Trying ElevenLabs first...", "info");
        
        const cacheKey = `${text}-elevenlabs`;
        
        // üîß –ó–ê–î–ï–†–ñ–ö–ê –ú–ï–ñ–î–£ –ó–ê–ü–†–û–°–ê–ú–ò
        const now = Date.now();
        const timeSinceLastRequest = now - lastRequestTime;
        if (timeSinceLastRequest < 1000) {
          addDebugLog(`‚è≥ Waiting ${1000 - timeSinceLastRequest}ms...`, "info");
          await new Promise(resolve => setTimeout(resolve, 1000 - timeSinceLastRequest));
        }
        lastRequestTime = Date.now();

        // ‚úÖ –ü–†–û–í–ï–†–ö–ê –ö–≠–®–ê
        if (ttsCache.has(cacheKey)) {
          addDebugLog("‚úÖ Using CACHED premium audio", "success");
          const cachedUrl = ttsCache.get(cacheKey);
          setAudioUrl(cachedUrl);
          
          try {
            const audio = new Audio(cachedUrl);
            audioRef.current = audio;
            await audio.play();
            setTtsStatus("elevenlabs_cached");
            setIsLoading(false);
            return;
          } catch (playError) {
            addDebugLog(`‚ùå Cached audio play error: ${playError.message}`, "error");
            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∫ –Ω–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É
          }
        }

        // –ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ ElevenLabs
        try {
          addDebugLog("üîÑ Calling ElevenLabs Premium...", "info");
          setTtsStatus("loading");
          
          const { url } = await callElevenLabsTTS(text);
          
          setAudioUrl(url);
          ttsCache.set(cacheKey, url);
          addDebugLog("‚úÖ ElevenLabs PREMIUM SUCCESS!", "success");
          
          // –ü—Ä–æ–±—É–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏
          try {
            const audio = new Audio(url);
            audioRef.current = audio;
            await audio.play();
            setTtsStatus("elevenlabs");
            setIsLoading(false);
            return;
          } catch (playError) {
            addDebugLog(`‚ùå ElevenLabs audio play error: ${playError.message}`, "error");
            setTtsStatus("elevenlabs_created");
            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∫ Web Speech
          }
          
        } catch (err) {
          addDebugLog(`üí• ElevenLabs failed: ${err.message}`, "error");
          // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∫ Web Speech
        }
      }

      // Fallback: Web Speech API
      addDebugLog("üîÑ Falling back to Web Speech API...", "info");
      
      try {
        await speakWithWebSpeech(text, "de-DE");
        setTtsStatus("web_speech");
      } catch (wsErr) {
        addDebugLog(`üí• All TTS failed: ${wsErr.message}`, "error");
        setTtsStatus("error");
        setError(`–û–∑–≤—É—á–∏–≤–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ: ${wsErr.message}`);
      } finally {
        setIsLoading(false);
      }
    };

    // Sprechen: parse dialogue lines (DE / RU)
    const parseDialogueLines = useCallback((deText, ruText) => {
      const deLines = (deText || "").split('\n').map(l => l.trim()).filter(Boolean);
      const ruLines = (ruText || "").split('\n').map(l => l.trim()).filter(Boolean);
      return deLines.map((de, i) => {
        const speakerMatch = de.match(/^(A:|B:)/);
        const speaker = speakerMatch ? speakerMatch[0] : "A:";
        const de_text = de.replace(/^(A:|B:)\s*/, '');
        const ru_text = ruLines[i] ? ruLines[i].replace(/^(A:|B:)\s*/, '') : '';
        return { id: i, speaker, de_text, ru_text };
      });
    }, []);

    const parsedDialogue = useMemo(() => parseDialogueLines(activeDialogue.text_de, activeDialogue.text_ru), [activeDialogue, parseDialogueLines]);

    // Calculate progress for Schreiben
    useEffect(() => {
      if (view === 'schreiben') {
        const totalSections = Object.keys(selections).length;
        const completed = Object.keys(selections).filter(key => 
          selections[key] !== undefined
        ).length;
        setProgress(Math.round((completed / totalSections) * 100));
        
        // Update completed sections
        const newCompleted = new Set();
        Object.keys(selections).forEach(key => {
          if (selections[key] !== undefined) {
            newCompleted.add(key);
          }
        });
        setCompletedSections(newCompleted);
      }
    }, [selections, view]);

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∫–ª—é—á–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    useEffect(() => {
      const checkApiKey = async () => {
        if (ELEVEN_LABS_CONFIG.API_KEY && ELEVEN_LABS_CONFIG.API_KEY.length > 10) {
          addDebugLog("‚úÖ Valid ElevenLabs API key detected", "success");
          setPremiumMode(true);
          
          // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–ª—é—á —Å –∫–æ—Ä–æ—Ç–∫–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
          try {
            addDebugLog("üß™ Testing API key...", "info");
            await callElevenLabsTTS("Test");
            addDebugLog("üéâ API key works! Premium mode activated", "success");
          } catch (e) {
            addDebugLog(`‚ö†Ô∏è API key test failed: ${e.message}`, "warning");
            setPremiumMode(false);
          }
        } else {
          addDebugLog("‚ùå No valid API key found", "error");
          setPremiumMode(false);
        }
      };

      checkApiKey();
    }, []);

    useEffect(() => {
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∞—É–¥–∏–æ
      const audio = new Audio();
      const canPlayMP3 = audio.canPlayType('audio/mpeg');
      console.log("MP3 support:", canPlayMP3);
      
      if (canPlayMP3 === '') {
        addDebugLog("‚ö†Ô∏è MP3 may not be supported", "warning");
      }

      return () => { 
        ttsCache.forEach(url => URL.revokeObjectURL(url));
        ttsCache.clear();
        if (audioUrl) URL.revokeObjectURL(audioUrl); 
      };
    }, [audioUrl]);

    return (
      <div className="space-y-6">
        <header className="text-center mb-4">
          <h1 className="text-3xl font-extrabold text-blue-800">B2 German Exam Trainer</h1>
          <p className="text-sm text-gray-600">Schreiben & Sprechen ‚Äî {premiumMode ? "üéµ Premium TTS" : "üîá Basic TTS"}</p>
          
          {/* TTS Status Indicator */}
          <div className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium mt-2 ${
            ttsStatus === "elevenlabs" || ttsStatus === "elevenlabs_cached" ? "bg-green-100 text-green-800 pulse" :
            ttsStatus === "web_speech" ? "bg-yellow-100 text-yellow-800" :
            ttsStatus === "loading" ? "bg-blue-100 text-blue-800" :
            ttsStatus === "error" ? "bg-red-100 text-red-800" :
            "bg-gray-100 text-gray-800"
          }`}>
            {premiumMode && ttsStatus === "elevenlabs" && <Icon.Star className="mr-1 text-yellow-500" />}
            {ttsStatus === "elevenlabs" && "üéµ –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≥–æ–ª–æ—Å (ElevenLabs)"}
            {ttsStatus === "elevenlabs_cached" && "‚ö° –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥–æ–ª–æ—Å (ElevenLabs)"}
            {ttsStatus === "web_speech" && "üîá –ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–π –≥–æ–ª–æ—Å (Web Speech)"}
            {ttsStatus === "loading" && "üîÑ –ó–∞–≥—Ä—É–∑–∫–∞..."}
            {ttsStatus === "error" && "‚ùå –û—à–∏–±–∫–∞ TTS"}
            {ttsStatus === "unknown" && (premiumMode ? "üéµ Premium Mode Ready" : "üîá Basic Mode")}
          </div>

          {/* Premium Mode Indicator */}
          {premiumMode && (
            <div className="mt-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white px-4 py-2 rounded-full inline-flex items-center">
              <Icon.Star className="mr-2" />
              <span className="font-semibold">Premium Mode Active</span>
            </div>
          )}
        </header>

        <div className="flex justify-center mb-4 gap-4 flex-wrap">
          <div className="inline-flex bg-white rounded-xl shadow p-1">
            <button
              onClick={() => setView('schreiben')}
              className={`px-5 py-2 rounded-lg font-semibold ${view === 'schreiben' ? 'bg-blue-700 text-white' : 'text-gray-700 hover:bg-gray-100'}`}
            >
              Schreiben
            </button>
            <button
              onClick={() => setView('sprechen')}
              className={`px-5 py-2 rounded-lg font-semibold ${view === 'sprechen' ? 'bg-indigo-600 text-white' : 'text-gray-700 hover:bg-gray-100'}`}
            >
              Sprechen
            </button>
          </div>
          <button
            onClick={() => setShowDebug(!showDebug)}
            className={`px-4 py-2 rounded-lg font-semibold ${showDebug ? 'bg-red-600 text-white' : 'bg-gray-200 text-gray-700'}`}
          >
            <Icon.Bug className="inline mr-2" />
            {showDebug ? "–°–∫—Ä—ã—Ç—å Debug" : "–ü–æ–∫–∞–∑–∞—Ç—å Debug"}
          </button>
          <button 
            className="px-4 py-2 bg-purple-600 text-white rounded flex items-center"
            onClick={() => speakText("Hallo, das ist ein Test mit Premium TTS. –ü—Ä–∏–≤–µ—Ç, —ç—Ç–æ —Ç–µ—Å—Ç –ø—Ä–µ–º–∏—É–º –æ–∑–≤—É—á–∫–∏.")}
          >
            <Icon.Volume className="mr-2" />
            –¢–µ—Å—Ç –æ–∑–≤—É—á–∫–∏
          </button>
        </div>

        {showDebug && (
          <div className="card">
            <h3 className="text-lg font-semibold text-gray-800 mb-2">TTS Debug Panel</h3>
            <div className="debug-panel">
              {debugLog.map((log, i) => (
                <div key={i} className={log.type === "error" ? "text-red-400" : log.type === "success" ? "text-green-400" : log.type === "warning" ? "text-yellow-400" : "text-gray-300"}>
                  {log.message}
                </div>
              ))}
            </div>
            <div className="mt-2 text-sm text-gray-600">
              üí° <strong className="text-green-400">ElevenLabs</strong> = –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≥–æ–ª–æ—Å | <strong className="text-yellow-400">Web Speech</strong> = –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–π –≥–æ–ª–æ—Å
              {premiumMode && <span className="text-purple-500 font-semibold"> | üéµ PREMIUM MODE ACTIVE</span>}
            </div>
          </div>
        )}

        <main className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* LEFT column: controls (Schreiben) */}
          {view === 'schreiben' && (
            <div className="lg:col-span-1 space-y-4">
              <div className="card">
                <h3 className="text-lg font-semibold text-gray-800 mb-2">1. –í—ã–±–æ—Ä —Ç–µ–º—ã</h3>
                <select
                  value={activeTopic.id}
                  onChange={(e) => setActiveTopic(SCHREIBEN_TOPICS.find(t => t.id === e.target.value))}
                  className="w-full p-3 rounded border border-gray-200"
                >
                  {SCHREIBEN_TOPICS.map(t => <option key={t.id} value={t.id}>{t.ru} ‚Äî {t.de}</option>)}
                </select>

                <div className="mt-4">
                  <label className="block text-sm text-gray-600">–í–∞—à–µ –ò–º—è</label>
                  <input className="w-full p-2 mt-1 border rounded" value={senderName} onChange={e => setSenderName(e.target.value)} />
                </div>

                <div className="mt-3">
                  <label className="block text-sm text-gray-600">–ù–æ–º–µ—Ä —Å—á—ë—Ç–∞ / –∑–∞–∫–∞–∑–∞</label>
                  <input className="w-full p-2 mt-1 border rounded" value={invoiceNumber} onChange={e => setInvoiceNumber(e.target.value)} />
                </div>

                {/* Progress indicator */}
                <div className="mt-4">
                  <div className="flex justify-between text-sm text-gray-600 mb-1">
                    <span>–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø–∏—Å—å–º–∞:</span>
                    <span>{progress}%</span>
                  </div>
                  <div className="w-full bg-gray-200 rounded-full h-2">
                    <div 
                      className="bg-green-600 h-2 rounded-full transition-all duration-300" 
                      style={{ width: `${progress}%` }}
                    ></div>
                  </div>
                </div>

                <div className="mt-4">
                  <button className="w-full bg-green-600 text-white py-2 rounded flex items-center justify-center" onClick={() => {
                    const newSel = Object.keys(PHRASES_DATA).reduce((acc, key) => {
                      const items = PHRASES_DATA[key];
                      acc[key] = items[Math.floor(Math.random()*items.length)].id;
                      return acc;
                    }, {});
                    setSelections(newSel);
                  }}>
                    <Icon.Refresh className="mr-2" /> –°–ª—É—á–∞–π–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è
                  </button>
                </div>
              </div>

              <div className="card">
                <h3 className="text-lg font-semibold mb-2">2. –§—Ä–∞–∑—ã (–≤—ã–±–µ—Ä–∏ –ø–æ –æ—á–µ—Ä–µ–¥–∏)</h3>
                <div className="space-y-3 max-h-96 overflow-y-auto pr-2">
                  {Object.keys(PHRASES_DATA).map(categoryKey => {
                    const sectionNames = {
                      'greetings': '1. –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ',
                      'issue_intro': '2. –í–≤–µ–¥–µ–Ω–∏–µ / –°—Å—ã–ª–∫–∞',
                      'main_problem': '3. –°—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã',
                      'problem_consequence': '4. –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è',
                      'evidence': '5. –î–æ–∫—É–º–µ–Ω—Ç—ã / —Å—Ä–æ–∫',
                      'resolution_request': '6. –ó–∞–ø—Ä–æ—Å —Ä–µ—à–µ–Ω–∏—è',
                      'closing_formula': '7. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ',
                      'sign_off': '8. –ü–æ–¥–ø–∏—Å—å'
                    };
                    
                    return (
                      <div key={categoryKey} className="fade-in">
                        <div className="text-sm font-semibold text-gray-700 mb-2 flex items-center">
                          {sectionNames[categoryKey]}
                          {completedSections.has(categoryKey) && (
                            <Icon.Check className="ml-2 text-green-600" />
                          )}
                        </div>
                        <div className="space-y-2">
                          {PHRASES_DATA[categoryKey].map(phrase => {
                            const active = selections[categoryKey] === phrase.id;
                            return (
                              <div key={phrase.id} className={`p-3 rounded ${active ? 'bg-blue-50 border-2 border-blue-200' : 'bg-gray-50 border border-gray-100' } flex justify-between items-start`}>
                                <div>
                                  <div className="font-medium">{replacePlaceholder(phrase.text)}</div>
                                  <div className="text-sm text-gray-500 mt-1 italic">{phrase.ru}</div>
                                </div>
                                <div className="ml-3 flex flex-col items-end">
                                  <button className="btn-icon bg-white border p-1 mb-2" title="–í—ã–±—Ä–∞—Ç—å" onClick={() => {
                                    setSelections(prev => ({ ...prev, [categoryKey]: phrase.id }));
                                  }}>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.6"><path d="M20 6L9 17l-5-5"/></svg>
                                  </button>
                                  <button className={`btn-icon p-1 ${premiumMode ? 'bg-purple-600 text-white' : 'bg-blue-600 text-white'}`} title="–û–∑–≤—É—á–∏—Ç—å" onClick={() => speakText(replacePlaceholder(phrase.text))}>
                                    {isLoading ? <Icon.Loader /> : <Icon.Volume />}
                                  </button>
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          )}

          {/* CENTER + RIGHT columns */}
          <div className={`space-y-6 ${view === 'schreiben' ? 'lg:col-span-2' : 'lg:col-span-3'}`}>
            {view === 'schreiben' && (
              <div className="card">
                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-xl font-bold text-gray-800">–ì–æ—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ</h2>
                  <div className="text-sm text-gray-600">–î–∞—Ç–∞: {currentDate}</div>
                </div>

                <div className="bg-gray-50 p-4 rounded border border-gray-100 min-h-[220px] whitespace-pre-wrap text-gray-800">
                  <pre className="m-0">{assembleLetterText()}</pre>
                </div>

                <div className="mt-4 flex gap-3 flex-wrap">
                  <button className={`px-4 py-2 rounded flex items-center ${premiumMode ? 'bg-purple-600 text-white' : 'bg-blue-700 text-white'}`} onClick={() => speakText(assembleLetterText())}>
                    {isLoading ? <Icon.Loader className="mr-2" /> : <Icon.Volume className="mr-2" />} 
                    {premiumMode ? 'üéµ –û–∑–≤—É—á–∏—Ç—å –ø–∏—Å—å–º–æ (Premium)' : '–û–∑–≤—É—á–∏—Ç—å –ø–∏—Å—å–º–æ'}
                  </button>

                  <button className="px-4 py-2 border rounded" onClick={() => {
                    navigator.clipboard.writeText(assembleLetterText()).then(()=> {
                      alert("–ü–∏—Å—å–º–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞");
                    });
                  }}>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>

                  <a className="px-4 py-2 border rounded text-sm" href={"data:text/plain;charset=utf-8," + encodeURIComponent(assembleLetterText())} download="letter.txt">–°–∫–∞—á–∞—Ç—å .txt</a>

                  {audioUrl && (
                    <div className="flex items-center gap-2">
                      <audio 
                        controls 
                        src={audioUrl} 
                        className="max-w-xs"
                        onError={(e) => console.error("Audio element error:", e)}
                        ref={audioRef}
                      />
                      <button 
                        className="px-3 py-1 bg-green-600 text-white rounded text-sm"
                        onClick={() => {
                          const audio = new Audio(audioUrl);
                          audio.play().catch(e => console.error("Play error:", e));
                        }}
                      >
                        –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏
                      </button>
                    </div>
                  )}
                </div>
              </div>
            )}

            {/* Sprechen module */}
            {view === 'sprechen' && (
              <div className="card">
                <div className="flex justify-between items-center mb-3">
                  <h3 className="text-lg font-semibold">{activeScenario.title_ru} ‚Äî {activeScenario.title_de}</h3>
                  <div className="flex items-center gap-2">
                    <select value={activeScenario.id} onChange={(e) => {
                      const s = SPRECHEN_SCENARIOS.find(x => x.id === e.target.value);
                      setActiveScenario(s);
                      setActiveDialogue(s.dialogues[0]);
                    }} className="p-2 border rounded">
                      {SPRECHEN_SCENARIOS.map(s => <option key={s.id} value={s.id}>{s.title_ru}</option>)}
                    </select>
                  </div>
                </div>

                <div className="mb-3">
                  {activeScenario.dialogues.length > 1 && (
                    <div className="flex gap-2 mb-3">
                      {activeScenario.dialogues.map(d => (
                        <button key={d.id} onClick={() => setActiveDialogue(d)} className={`px-3 py-1 rounded ${activeDialogue.id === d.id ? 'bg-indigo-600 text-white' : 'bg-gray-100'}`}>{d.title_ru}</button>
                      ))}
                    </div>
                  )}
                  <div className="text-sm text-gray-700 mb-2">{activeDialogue.title_ru}</div>

                  <div className="space-y-2 max-h-96 overflow-y-auto pr-2">
                    {parsedDialogue.map(line => (
                      <div key={line.id} className={`p-3 rounded ${line.speaker === 'A:' ? 'bg-blue-50 border-blue-100' : 'bg-gray-50 border-gray-100' } flex justify-between items-start`}>
                        <div>
                          <div className="font-semibold"><span className="mr-2">{line.speaker}</span>{line.de_text}</div>
                          <div className="text-sm italic text-gray-600 mt-1">{line.ru_text}</div>
                        </div>
                        <div className="ml-3">
                          <button className={`btn-icon p-1 ${premiumMode ? 'bg-purple-600 text-white' : 'bg-indigo-600 text-white'}`} title="–û–∑–≤—É—á–∏—Ç—å —Ä–µ–ø–ª–∏–∫—É" onClick={() => speakText(line.de_text)}>
                            {isLoading ? <Icon.Loader /> : <Icon.Volume />}
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>

                  <div className="mt-4 text-sm text-gray-600">
                    üí° –°–æ–≤–µ—Ç: —á–∏—Ç–∞–π —Ä–µ–ø–ª–∏–∫–∏ –≤—Å–ª—É—Ö, –ø–æ–≤—Ç–æ—Ä—è—è –∏–Ω—Ç–æ–Ω–∞—Ü–∏—é –∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ ‚Äî —ç—Ç–æ —Ç—Ä–µ–Ω–∏—Ä—É–µ—Ç –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ –∏ –ø–æ—Ç–æ–∫ —Ä–µ—á–∏.
                    {premiumMode && <span className="text-purple-600 font-semibold"> üéµ –°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –æ–∑–≤—É—á–∫–∞!</span>}
                  </div>
                </div>
              </div>
            )}
          </div>
        </main>

        {error && (
          <div className="fixed bottom-6 right-6 bg-red-600 text-white px-4 py-2 rounded shadow">
            –û—à–∏–±–∫–∞: {error}
          </div>
        )}

        <footer className="text-center text-xs text-gray-500 mt-8">
          –°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è ‚Äî {premiumMode ? "üéµ Premium TTS: ElevenLabs" : "üîá Basic TTS: Web Speech API"}
        </footer>
      </div>
    );
  }

  // Render
  const rootEl = document.getElementById('root');
  ReactDOM.createRoot(rootEl).render(<App />);

  </script>
</body>
</html>
