<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>B2 German Exam Trainer ‚Äî v7 Stable (Pro)</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React (UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#f8fafc; }
    .card { background:#fff; border-radius:12px; padding:1rem; box-shadow:0 6px 18px rgba(2,6,23,0.06); border:1px solid rgba(2,6,23,0.04); }
    .btn-icon { width:2.25rem; height:2.25rem; display:inline-flex; align-items:center; justify-content:center; border-radius:9999px; }
    pre { white-space: pre-wrap; word-break: break-word; }
    .pulse { animation: pulse 1.8s infinite; }
    @keyframes pulse { 0%,100%{ opacity:1 } 50%{ opacity:0.7 } }
    .debug-panel { background:#0b1220; color:#b7f5c6; padding:10px; border-radius:8px; font-family:monospace; font-size:12px; max-height:220px; overflow:auto; }
  </style>
</head>
<body class="p-6">

  <div id="root" class="max-w-6xl mx-auto"></div>

  <script type="text/babel">
  const { useState, useEffect, useMemo, useCallback, useRef } = React;

  /* ==================== CONFIG ==================== */
  // ElevenLabs API: –≤—Å—Ç–∞–≤—å —Å—é–¥–∞ –∫–ª—é—á –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–º–∏—É–º.
  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä. –î–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–µ–º–∏—É–º-–æ–∑–≤—É—á–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –≤—Å—Ç–∞–≤—å —Å–≤–æ–π –∫–ª—é—á.
  const ELEVEN = {
    API_KEY: "YOUR_ELEVENLABS_API_KEY", // <-- –í—Å—Ç–∞–≤—å —Å—é–¥–∞ API-–∫–ª—é—á, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –ø—Ä–µ–º–∏—É–º
    VOICE_ID: "21m00Tcm4TlvDq8ikWAM",   // Rachel (–∂–µ–Ω—Å–∫–∏–π) ‚Äî –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å
    BASE_URL: "https://api.elevenlabs.io/v1/text-to-speech"
  };

  /* ==================== DATA ==================== */
  const SCHREIBEN_TOPICS = [
    { id: 'produkt', ru: '1. –¢–æ–≤–∞—Ä (–¥–µ—Ñ–µ–∫—Ç)', de: 'der neue Staubsauger' },
    { id: 'service', ru: '2. –£—Å–ª—É–≥–∞ (–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ)', de: 'Ihr Internetanschluss' },
    { id: 'kurs', ru: '3. –ö—É—Ä—Å/–®–∫–æ–ª–∞ (–Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏)', de: 'der Deutsch B2-Kurs' },
    { id: 'reise', ru: '4. –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ/–û—Ç–µ–ª—å (–Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏)', de: 'das gebuchte Hotelzimmer' },
    { id: 'wohnung', ru: '5. –î–µ—Ñ–µ–∫—Ç –≤ –∫–≤–∞—Ä—Ç–∏—Ä–µ', de: 'die Heizungsanlage in meiner Wohnung' },
    { id: 'rechnung', ru: '6. –°—á–µ—Ç/–î–æ–≥–æ–≤–æ—Ä (–æ—à–∏–±–∫–∞)', de: 'meine letzte Rechnung' },
    { id: 'transport', ru: '7. –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç (–∑–∞–¥–µ—Ä–∂–∫–∞/–ø—Ä–æ–±–ª–µ–º–∞)', de: 'die Bahnverbindung nach Berlin' },
  ];

  const PHRASES_DATA = {
    greetings: [ { id: 101, text: "Sehr geehrte Damen und Herren,", ru: "–£–≤–∞–∂–∞–µ–º—ã–µ –¥–∞–º—ã –∏ –≥–æ—Å–ø–æ–¥–∞,", tip: "–§–æ—Ä–º–∞–ª—å–Ω–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ." } ],
    issue_intro: [
      { id: 201, text: "Ich schreibe Ihnen bez√ºglich [–æ–±—ä–µ–∫—Ç –∂–∞–ª–æ–±—ã].", ru: "–Ø –ø–∏—à—É –í–∞–º –ø–æ –ø–æ–≤–æ–¥—É [–æ–±—ä–µ–∫—Ç –∂–∞–ª–æ–±—ã].", tip: "bez√ºglich + Genitiv." },
      { id: 202, text: "Ich beziehe mich auf unsere Bestellung/Vereinbarung vom [–î–∞—Ç–∞].", ru: "–Ø —Å—Å—ã–ª–∞—é—Å—å –Ω–∞ –Ω–∞—à –∑–∞–∫–∞–∑/–¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –æ—Ç [–î–∞—Ç–∞].", tip: "sich beziehen auf + Akk." }
    ],
    main_problem: [
      { id: 301, text: "Leider muss ich Ihnen mitteilen, dass [–æ–±—ä–µ–∫—Ç –∂–∞–ª–æ–±—ã] nicht der Beschreibung entspricht.", ru: "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, [–æ–±—ä–µ–∫—Ç –∂–∞–ª–æ–±—ã] –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—é.", tip: "–ü—Ä–∏–¥–∞—Ç–æ—á–Ω–æ–µ —Å 'dass' ‚Äî –≥–ª–∞–≥–æ–ª –≤ –∫–æ–Ω—Ü–µ." },
      { id: 302, text: "Der Hauptgrund f√ºr meine Beschwerde ist, dass es M√§ngel gibt.", ru: "–ü—Ä–∏—á–∏–Ω–∞ –∂–∞–ª–æ–±—ã ‚Äî –Ω–∞–ª–∏—á–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤.", tip: "M√§ngel ‚Äî –º–Ω. —á–∏—Å–ª–æ." }
    ],
    problem_consequence: [
      { id: 401, text: "Aufgrund dieses Problems konnte ich meine Arbeit nicht wie geplant durchf√ºhren.", ru: "–ò–∑-–∑–∞ —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã —è –Ω–µ —Å–º–æ–≥ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–∞–±–æ—Ç—É –∫–∞–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–ª.", tip: "Aufgrund + Genitiv." },
      { id: 402, text: "Das hat bei mir zu gro√üem √Ñrger und Unannehmlichkeiten gef√ºhrt.", ru: "–≠—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ –±–æ–ª—å—à–∏–º –Ω–µ—É–¥–æ–±—Å—Ç–≤–∞–º.", tip: "–í—ã—Ä–∞–∂–µ–Ω–∏–µ 'zu √Ñrger f√ºhren'." }
    ],
    evidence: [
      { id: 501, text: "Ich habe Ihnen alle notwendigen Unterlagen in der Anlage beigef√ºgt.", ru: "–Ø –ø—Ä–∏–ª–æ–∂–∏–ª –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã.", tip: "beif√ºgen ‚Äî Perfekt: habe beigef√ºgt." },
      { id: 502, text: "Ich m√∂chte Sie bitten, die Angelegenheit innerhalb von 14 Tagen zu kl√§ren.", ru: "–ü—Ä–æ—à—É —Ä–µ—à–∏—Ç—å –≤–æ–ø—Ä–æ—Å –≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π.", tip: "Konjunktiv/Aufforderung." }
    ],
    resolution_request: [
      { id: 601, text: "Daher bitte ich Sie h√∂flich um eine schnelle L√∂sung und um Ersatz.", ru: "–ü—Ä–æ—à—É —Å—Ä–æ—á–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –∏ –∑–∞–º–µ–Ω—ã.", tip: "Daher ‚Äî —Å–ª–µ–¥—Å—Ç–≤–∏–µ." },
      { id: 602, text: "Falls dies nicht m√∂glich ist, erwarte ich die volle R√ºckerstattung des Kaufpreises.", ru: "–ï—Å–ª–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ ‚Äî –æ–∂–∏–¥–∞—é –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å—Ä–µ–¥—Å—Ç–≤.", tip: "Falls = –µ—Å–ª–∏." }
    ],
    closing_formula: [ { id: 701, text: "Ich danke Ihnen f√ºr Ihre M√ºhe und hoffe auf eine schnelle Kl√§rung.", ru: "–ë–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –≤–Ω–∏–º–∞–Ω–∏–µ –∏ –Ω–∞–¥–µ—é—Å—å –Ω–∞ –±—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ.", tip: "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞." } ],
    sign_off: [ { id: 801, text: "Mit freundlichen Gr√º√üen,", ru: "–° —É–≤–∞–∂–µ–Ω–∏–µ–º,", tip: "–ü–æ–¥–ø–∏—Å—å." } ],
  };

  // –ü–æ–ª–Ω—ã–π –±–ª–æ–∫ Sprechen: 6 —Ç–µ–º (–≤–∑—è–ª –∏–∑ —Ç–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö)
  const SPRECHEN_SCENARIOS = [
    {
      id: 'thema1',
      title_ru: '–¢–µ–º–∞ 1: –û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è',
      title_de: 'Thema 1: Arbeitgeber beschreiben',
      dialogues: [
        {
          id: '1a',
          title_ru: 'A. –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è IT-–∫–æ–º–ø–∞–Ω–∏—è',
          text_de: `A: Ich m√∂chte √ºber einen Arbeitgeber sprechen, bei dem ich gerne arbeiten w√ºrde ‚Äì ein internationales IT-Unternehmen.
B: Klingt spannend. In welcher Branche ist das Unternehmen t√§tig?
A: Es entwickelt Softwarel√∂sungen f√ºr gro√üe Firmen, zum Beispiel f√ºr Banken und Versicherungen.
B: Und welche Abteilungen gibt es dort?
A: Es gibt eine Entwicklungsabteilung, ein Marketingteam, den Kundenservice und die Personalabteilung.`,
          text_ru: `A: –Ø —Ö–æ—á—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ ‚Äî –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–π IT-–∫–æ–º–ø–∞–Ω–∏–∏.
B: –í –∫–∞–∫–æ–π –æ—Ç—Ä–∞—Å–ª–∏ –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç?
A: –û–Ω–∞ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ü–û –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π.
B: –ö–∞–∫–∏–µ –æ—Ç–¥–µ–ª—ã —Ç–∞–º –µ—Å—Ç—å?
A: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞, –º–∞—Ä–∫–µ—Ç–∏–Ω–≥, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ HR.`
        },
        {
          id: '1b',
          title_ru: 'B. –ö–æ–º–ø–∞–Ω–∏—è —Å —Ö–æ—Ä–æ—à–∏–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏ —Ç—Ä—É–¥–∞',
          text_de: `A: Ich kenne ein Unternehmen, das ein sehr gutes Arbeitsumfeld bietet ‚Äì es ist ein mittelst√§ndisches Familienunternehmen.
B: Was macht das Arbeitsumfeld dort so gut?
A: Die Atmosph√§re ist freundlich und respektvoll. Die Mitarbeiter arbeiten gern zusammen.
B: Und wie sieht es mit dem Gehalt aus?
A: Die L√∂hne sind fair und es gibt regelm√§√üige Gehaltserh√∂hungen.`,
          text_ru: `A: –Ø –∑–Ω–∞—é –∫–æ–º–ø–∞–Ω–∏—é —Å –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–∏–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏ —Ç—Ä—É–¥–∞ ‚Äî —ç—Ç–æ —Å—Ä–µ–¥–Ω—è—è —Å–µ–º–µ–π–Ω–∞—è —Ñ–∏—Ä–º–∞.
B: –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —É—Å–ª–æ–≤–∏—è —Ç—Ä—É–¥–∞ —Ç–∞–º —Ç–∞–∫–∏–º–∏ —Ö–æ—Ä–æ—à–∏–º–∏?
A: –ê—Ç–º–æ—Å—Ñ–µ—Ä–∞ –¥—Ä—É–∂–µ–ª—é–±–Ω–∞—è –∏ —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–∞—è. –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –æ—Ö–æ—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ.`
        }
      ]
    },
    {
      id: 'thema2',
      title_ru: '–¢–µ–º–∞ 2: –°–æ–±—ã—Ç–∏—è, –ø–æ–≤–ª–∏—è–≤—à–∏–µ –Ω–∞ –≤—ã–±–æ—Ä –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏',
      title_de: 'Thema 2: Ereignisse und Erfahrungen',
      dialogues: [
        {
          id: '2a',
          title_ru: 'A. –î–µ—Ç—Å–∫–∏–π –∏–Ω—Ç–µ—Ä–µ—Å –∫ —Ç–µ—Ö–Ω–∏–∫–µ',
          text_de: `A: Ich habe mich f√ºr meinen Beruf entschieden, weil ich schon als Kind gro√ües Interesse an Technik hatte.
B: Gab es ein besonderes Erlebnis, das dich beeinflusst hat?
A: Ja, in der Schule haben wir einen Roboter gebaut. Das hat mich fasziniert.
B: Hast du auch ein Praktikum gemacht?
A: Ja, zwei Wochen in einer IT-Firma.`,
          text_ru: `A: –Ø –≤—ã–±—Ä–∞–ª –ø—Ä–æ—Ñ–µ—Å—Å–∏—é, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å –¥–µ—Ç—Å—Ç–≤–∞ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–ª—Å—è —Ç–µ—Ö–Ω–∏–∫–æ–π.
B: –ë—ã–ª–æ –ª–∏ —Å–æ–±—ã—Ç–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–≤–ª–∏—è–ª–æ?
A: –î–∞, –ø—Ä–æ–µ–∫—Ç —Å —Ä–æ–±–æ—Ç–æ–º –≤ —à–∫–æ–ª–µ.`
        }
      ]
    },
    {
      id: 'thema3',
      title_ru: '–¢–µ–º–∞ 3: –ß–µ–ª–æ–≤–µ–∫, –ø–æ–≤–ª–∏—è–≤—à–∏–π –Ω–∞ –≤—ã–±–æ—Ä –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏',
      title_de: 'Thema 3: Eine Person, die Ihre Berufswahl beeinflusst hat',
      dialogues: [
        {
          id: '3a',
          title_ru: 'A. –í–ª–∏—è–Ω–∏–µ —Å—Ç–∞—Ä—à–µ–≥–æ –±—Ä–∞—Ç–∞',
          text_de: `A: Mein √§lterer Bruder ist Grafikdesigner und hat mich sehr beeinflusst.
B: Wodurch hat er dich beeinflusst?
A: Er hat mir gezeigt, wie kreativ Arbeit sein kann. Wir haben gemeinsam ein Logo f√ºr ein Schulprojekt entworfen.`,
          text_ru: `A: –ú–æ–π —Å—Ç–∞—Ä—à–∏–π –±—Ä–∞—Ç ‚Äî –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω–µ—Ä, –æ–Ω –ø–æ–≤–ª–∏—è–ª –Ω–∞ –º–µ–Ω—è.
B: –ö–∞–∫ –∏–º–µ–Ω–Ω–æ?
A: –û–Ω –ø–æ–∫–∞–∑–∞–ª –º–Ω–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞, –º—ã –≤–º–µ—Å—Ç–µ –¥–µ–ª–∞–ª–∏ –ª–æ–≥–æ—Ç–∏–ø.`
        }
      ]
    },
    {
      id: 'thema4',
      title_ru: '–¢–µ–º–∞ 4: –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç—ã –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–µ',
      title_de: 'Thema 4: Arbeitssuche in einem Land Ihrer Wahl',
      dialogues: [
        {
          id: '4a',
          title_ru: 'A. –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–∏—Å–∫–∞ —Ä–∞–±–æ—Ç—ã –≤ –ì–µ—Ä–º–∞–Ω–∏–∏',
          text_de: `A: Ich m√∂chte √ºber die Arbeitssuche in Deutschland sprechen.
B: Wo sucht man zuerst?
A: Man sucht online, zum Beispiel auf StepStone oder Indeed.
B: Und wie bereitet man sich vor?
A: Man informiert sich √ºber die Firma und schreibt eine gute Bewerbung.`,
          text_ru: `A: –Ø —Ö–æ—á—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ –ø–æ–∏—Å–∫–µ —Ä–∞–±–æ—Ç—ã –≤ –ì–µ—Ä–º–∞–Ω–∏–∏.
B: –° —á–µ–≥–æ –Ω–∞—á–∞—Ç—å?
A: –° –ø–æ–∏—Å–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–π –æ–Ω–ª–∞–π–Ω –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∑–∞—è–≤–∫–∏.`
        }
      ]
    },
    {
      id: 'thema5',
      title_ru: '–¢–µ–º–∞ 5: –ù–∞ —á—Ç–æ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–∏ –ø–æ–¥–∞—á–µ –∑–∞—è–≤–∫–∏',
      title_de: 'Thema 5: Worauf es bei einem Bewerbungsprozess ankommt',
      dialogues: [
        {
          id: '5a',
          title_ru: 'A. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—é',
          text_de: `A: Ein erfolgreicher Bewerbungsprozess beginnt mit guter Vorbereitung.
B: Was beinhaltet gute Vorbereitung?
A: Informationen √ºber die Firma, ein klares Lebenslauf und ein pers√∂nliches Anschreiben.`,
          text_ru: `A: –£—Å–ø–µ—Ö –ø—Ä–∏ –ø–æ–¥–∞—á–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏.
B: –ß—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É?
A: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–∞–Ω–∏–∏, —á—ë—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –∏ –ª–∏—á–Ω–æ–µ —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ.`
        }
      ]
    },
    {
      id: 'thema6',
      title_ru: '–¢–µ–º–∞ 6: –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞/—É—Å–ª—É–≥–∏',
      title_de: 'Thema 6: Ein Produkt / eine Dienstleistung Ihrer Wahl',
      dialogues: [
        {
          id: '6a',
          title_ru: 'A. –ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã–µ –Ω–∞—É—à–Ω–∏–∫–∏',
          text_de: `A: Ich m√∂chte ein Produkt beschreiben ‚Äî meine kabellosen Kopfh√∂rer.
B: Welche Eigenschaften sind wichtig?
A: Leichtes Gewicht, gute Klangqualit√§t und lange Akkulaufzeit.`,
          text_ru: `A: –Ø –æ–ø–∏—à—É –ø—Ä–æ–¥—É–∫—Ç ‚Äî –º–æ–∏ –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã–µ –Ω–∞—É—à–Ω–∏–∫–∏.
B: –ö–∞–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤–∞–∂–Ω—ã?
A: –õ—ë–≥–∫–æ—Å—Ç—å, –∫–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞ –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–∞—Ç–∞—Ä–µ–∏.`
        }
      ]
    }
  ];

  const initialActiveScenario = SPRECHEN_SCENARIOS[0];

  /* ==================== AUDIO HELPERS ==================== */

  // Cache for fetched audio (Map key->objectURL)
  const ttsCache = new Map();

  // AudioContext singleton
  let audioCtx = null;
  function getAudioContext(){
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    return audioCtx;
  }

  // Fetch ElevenLabs audio (returns Blob)
  async function fetchElevenAudio(text, voiceId = ELEVEN.VOICE_ID) {
    if (!ELEVEN.API_KEY || ELEVEN.API_KEY === "YOUR_ELEVENLABS_API_KEY") {
      throw new Error("ElevenLabs API key missing or placeholder");
    }
    const endpoint = `${ELEVEN.BASE_URL}/${voiceId}`;
    const body = {
      text,
      model_id: "eleven_multilingual_v2",
      voice_settings: { stability: 0.4, similarity_boost: 0.6 }
    };
    const res = await fetch(endpoint, {
      method: "POST",
      headers: { "Accept":"audio/mpeg", "Content-Type":"application/json", "xi-api-key": ELEVEN.API_KEY },
      body: JSON.stringify(body)
    });
    if (!res.ok) {
      const txt = await res.text().catch(()=>"");
      throw new Error(`ElevenLabs responded ${res.status}: ${txt}`);
    }
    const blob = await res.blob();
    if (!blob || blob.size === 0) throw new Error("Empty audio blob");
    return blob;
  }

  // Play Blob using AudioContext (decodeAudioData) ‚Äî Chrome-safe
  async function playBlob(blob) {
    const ctx = getAudioContext();
    // unlock context on first user gesture in Chrome if needed
    if (ctx.state === 'suspended') {
      try { await ctx.resume(); } catch(e){}
    }
    const arr = await blob.arrayBuffer();
    const audioBuffer = await ctx.decodeAudioData(arr.slice(0));
    const source = ctx.createBufferSource();
    source.buffer = audioBuffer;
    const gain = ctx.createGain();
    gain.gain.value = 1.0;
    source.connect(gain).connect(ctx.destination);
    source.start(0);
    // keep source alive until end
    return new Promise(resolve => {
      source.onended = () => resolve();
      // resolve also shortly after start so UI can update
      setTimeout(()=>resolve(), 100);
    });
  }

  // Web Speech fallback
  function speakWebSpeech(text, lang = "de-DE") {
    return new Promise((resolve, reject)=>{
      if (!("speechSynthesis" in window)) return reject(new Error("SpeechSynthesis not supported"));
      if (window.speechSynthesis.getVoices().length === 0) {
        window.speechSynthesis.addEventListener('voiceschanged', ()=> {
          speakWebSpeech(text, lang).then(resolve).catch(reject);
        }, { once:true });
        return;
      }
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = lang;
      u.rate = 0.95;
      u.onend = () => resolve();
      u.onerror = (e) => reject(e);
      // choose german voice if available
      const voices = window.speechSynthesis.getVoices();
      const g = voices.find(v => v.lang && v.lang.startsWith('de'));
      if (g) u.voice = g;
      window.speechSynthesis.speak(u);
    });
  }

  // Top-level speak: try cache -> ElevenLabs -> WebSpeech
  async function speakTextGermanOnly(text, onLog = ()=>{}) {
    if (!text || !text.trim()) return { engine: "none" };
    const key = `eleven:${text.slice(0,300)}`;
    try {
      if (ttsCache.has(key)) {
        onLog("Using cached audio");
        const url = ttsCache.get(key);
        // fetch blob back and play via AudioContext
        const resp = await fetch(url);
        const blob = await resp.blob();
        await playBlob(blob);
        return { engine: "eleven_cached" };
      }
      onLog("Requesting ElevenLabs...");
      const blob = await fetchElevenAudio(text);
      const obj = URL.createObjectURL(blob);
      ttsCache.set(key, obj);
      onLog("Playing ElevenLabs via AudioContext...");
      await playBlob(blob);
      return { engine: "eleven" };
    } catch (e) {
      onLog("ElevenLabs failed: " + (e.message || e));
      onLog("Falling back to Web Speech...");
      try {
        await speakWebSpeech(text, "de-DE");
        return { engine: "webspeech" };
      } catch (we) {
        onLog("WebSpeech failed: " + (we.message || we));
        throw new Error("All TTS failed");
      }
    }
  }

  /* ==================== UI ICONS ==================== */
  const Icon = {
    Volume: (p)=>(<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" strokeWidth="1.6" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M19 5c.4 1.1.5 2.3.5 3.5s-.1 2.4-.5 3.5"/><path d="M15 9.5c.3.8.5 1.7.5 2.5s-.2 1.7-.5 2.5"/></svg>),
    Loader: (p)=>(<svg viewBox="0 0 24 24" width="16" height="16" className="animate-spin" {...p}><circle cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="2" fill="none" strokeDasharray="31.4 31.4" strokeLinecap="round"/></svg>),
    Check: (p)=>(<svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M20 6L9 17l-5-5"/></svg>),
    Refresh: (p)=>(<svg viewBox="0 0 24 24" width="16" height="16" {...p}><path d="M21 12a9 9 0 1 0-3.2 6.7L21 18" stroke="currentColor" strokeWidth="1.6" fill="none"/><path d="M21 12v6h-6" stroke="currentColor" strokeWidth="1.6" fill="none"/></svg>)
  };

  /* ==================== APP ==================== */
  function App(){
    // default: Schreiben
    const [view, setView] = useState('schreiben');
    const [selections, setSelections] = useState(useMemo(()=>({
      greetings: PHRASES_DATA.greetings[0].id,
      issue_intro: PHRASES_DATA.issue_intro[0].id,
      main_problem: PHRASES_DATA.main_problem[0].id,
      problem_consequence: PHRASES_DATA.problem_consequence[0].id,
      evidence: PHRASES_DATA.evidence[0].id,
      resolution_request: PHRASES_DATA.resolution_request[0].id,
      closing_formula: PHRASES_DATA.closing_formula[0].id,
      sign_off: PHRASES_DATA.sign_off[0].id,
    }),[]));
    const [activeTopic, setActiveTopic] = useState(SCHREIBEN_TOPICS[0]);
    const [senderName, setSenderName] = useState("Ivan Ivanov");
    const [invoiceNumber, setInvoiceNumber] = useState("RE-2024-5829");
    const [currentDate] = useState(new Date().toLocaleDateString('de-DE'));
    const [activeScenario, setActiveScenario] = useState(initialActiveScenario);
    const [activeDialogue, setActiveDialogue] = useState(initialActiveScenario.dialogues[0]);

    const [isLoading, setIsLoading] = useState(false);
    const [status, setStatus] = useState("–ì–æ—Ç–æ–≤–æ");
    const [debug, setDebug] = useState([]);
    const [showDebug, setShowDebug] = useState(false);
    const [audioUnlocked, setAudioUnlocked] = useState(false);

    // helpers
    const allPhrases = useMemo(()=>Object.values(PHRASES_DATA).flat(), []);
    const findPhraseById = useCallback((id)=> allPhrases.find(p=>p.id===id), [allPhrases]);
    const replacePlaceholder = useCallback((text)=> {
      if (!text) return '';
      return text.replace(/\[–æ–±—ä–µ–∫—Ç –∂–∞–ª–æ–±—ã\]/g, activeTopic.de).replace(/\[–î–∞—Ç–∞\]/g, currentDate);
    }, [activeTopic, currentDate]);

    const assembleLetter = useCallback(()=> {
      const parts = [
        replacePlaceholder(findPhraseById(selections.greetings)?.text || ''),
        replacePlaceholder(findPhraseById(selections.issue_intro)?.text || ''),
        replacePlaceholder(findPhraseById(selections.main_problem)?.text || ''),
        replacePlaceholder(findPhraseById(selections.problem_consequence)?.text || ''),
        replacePlaceholder(findPhraseById(selections.evidence)?.text || ''),
        replacePlaceholder(findPhraseById(selections.resolution_request)?.text || ''),
        replacePlaceholder(findPhraseById(selections.closing_formula)?.text || ''),
        replacePlaceholder(findPhraseById(selections.sign_off)?.text || ''),
        senderName
      ];
      return parts.filter(Boolean).join("\n\n");
    }, [selections, findPhraseById, replacePlaceholder, senderName]);

    const log = useCallback((msg, type='info') => {
      setDebug(prev => [...prev, { t: new Date().toLocaleTimeString(), m: msg, type }].slice(-60));
      console.log(type.toUpperCase(), msg);
    }, []);

    // parse dialogues
    const parseDialogueLines = useCallback((deText, ruText) => {
      const de = (deText||"").split('\n').map(l=>l.trim()).filter(Boolean);
      const ru = (ruText||"").split('\n').map(l=>l.trim()).filter(Boolean);
      return de.map((line, i) => {
        const m = line.match(/^(A:|B:)/);
        const speaker = m ? m[0] : 'A:';
        const de_text = line.replace(/^(A:|B:)\s*/, '');
        const ru_text = ru[i] ? ru[i].replace(/^(A:|B:)\s*/, '') : '';
        return { id:i, speaker, de_text, ru_text };
      });
    }, []);
    const parsedDialogue = useMemo(()=> parseDialogueLines(activeDialogue.text_de, activeDialogue.text_ru), [activeDialogue, parseDialogueLines]);

    // First-click unlock audio for Chrome
    const unlockAudio = useCallback(async ()=> {
      try {
        const ctx = getAudioContext();
        if (ctx.state === 'suspended') {
          await ctx.resume();
          log("AudioContext resumed");
        }
        setAudioUnlocked(true);
        setStatus("–ê—É–¥–∏–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ");
        log("Audio unlocked by user gesture");
      } catch(e){
        log("Unlock failed: " + (e.message||e), "error");
        setStatus("–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∞—É–¥–∏–æ");
      }
    }, [log]);

    // top-level speak (German only)
    const speakGerman = useCallback(async (text) => {
      setStatus("–ì–µ–Ω–µ—Ä–∏—Ä—É—é –æ–∑–≤—É—á–∫—É...");
      setIsLoading(true);
      try {
        // ensure audio unlocked or try to resume
        try {
          const ctx = getAudioContext();
          if (ctx.state === 'suspended') {
            // will throw if no user gesture yet
            await ctx.resume().catch(()=>{});
          }
        } catch(e){}
        const res = await speakTextGermanOnly(text, (l)=>log(l));
        setStatus(res.engine ? `–û–∑–≤—É—á–µ–Ω–æ: ${res.engine}` : "–û–∑–≤—É—á–µ–Ω–æ");
      } catch(e){
        log("TTS error: " + (e.message||e), "error");
        setStatus("–û—à–∏–±–∫–∞ TTS ‚Äî fallback...");
        // try simple fallback
        try {
          await speakWebSpeech(text, "de-DE");
          setStatus("–û–∑–≤—É—á–µ–Ω–æ: WebSpeech (fallback)");
        } catch(we){
          log("WebSpeech also failed: " + (we.message||we), "error");
          setStatus("–û–∑–≤—É—á–∏–≤–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ");
        }
      } finally {
        setIsLoading(false);
      }
    }, [log]);

    // test buttons
    const handleTestPremium = async () => {
      await unlockAudio();
      const sample = "Hallo! Dies ist ein Test des Premium-TTS.";
      await speakGerman(sample);
    };
    const handleTestWeb = async () => {
      await unlockAudio();
      try {
        setStatus("–ü—Ä–æ–±—É—é Web Speech...");
        await speakWebSpeech("Hallo! Dies ist ein Test der Browserstimme.", "de-DE");
        setStatus("–û–∑–≤—É—á–µ–Ω–æ: Web Speech");
      } catch(e){ log("WebSpeech failed: "+(e.message||e), "error"); setStatus("Web Speech failed"); }
    };

    // cleanup objectURLs on unload
    useEffect(()=> {
      const onUnload = ()=> {
        ttsCache.forEach(u => { try{ URL.revokeObjectURL(u); } catch(e){} });
      };
      window.addEventListener('beforeunload', onUnload);
      return ()=> window.removeEventListener('beforeunload', onUnload);
    }, []);

    return (
      <div className="space-y-6">
        <header className="text-center mb-4">
          <h1 className="text-3xl font-extrabold text-blue-800">B2 German Exam Trainer ‚Äî v7 Stable</h1>
          <p className="text-sm text-gray-600">Schreiben & Sprechen ‚Äî Pro style. –û–∑–≤—É—á–∫–∞: ElevenLabs ‚Üí Web Speech (fallback).</p>

          <div className="mt-3 flex items-center justify-center gap-3 flex-wrap">
            <button onClick={()=>setView('schreiben')} className={`px-5 py-2 rounded-lg font-semibold ${view==='schreiben' ? 'bg-blue-700 text-white' : 'text-gray-700 hover:bg-gray-100'}`}>Schreiben</button>
            <button onClick={()=>setView('sprechen')} className={`px-5 py-2 rounded-lg font-semibold ${view==='sprechen' ? 'bg-indigo-600 text-white' : 'text-gray-700 hover:bg-gray-100'}`}>Sprechen</button>

            <button onClick={unlockAudio} className="px-4 py-2 bg-purple-600 text-white rounded flex items-center">
              üéß –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∑–≤—É–∫
            </button>

            <button onClick={handleTestPremium} className="px-3 py-2 border rounded text-sm">üéµ –¢–µ—Å—Ç Premium</button>
            <button onClick={handleTestWeb} className="px-3 py-2 border rounded text-sm">üîá –¢–µ—Å—Ç Web Speech</button>

            <button onClick={()=>setShowDebug(s=>!s)} className="px-3 py-2 border rounded text-sm">{showDebug ? "–°–∫—Ä—ã—Ç—å –ª–æ–≥" : "–ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥"}</button>
          </div>

          <div className="mt-3 text-sm">
            <span className={`inline-block px-3 py-1 rounded-full text-sm bg-gray-100`}>{isLoading ? "–ó–∞–≥—Ä—É–∑–∫–∞..." : status}</span>
          </div>
        </header>

        <main className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* LEFT: Schreiben controls */}
          <div className="lg:col-span-1 space-y-4">
            <div className="card">
              <h3 className="text-lg font-semibold mb-2">1. –í—ã–±–æ—Ä —Ç–µ–º—ã</h3>
              <select value={activeTopic.id} onChange={(e)=> setActiveTopic(SCHREIBEN_TOPICS.find(t=>t.id===e.target.value))} className="w-full p-3 rounded border">
                {SCHREIBEN_TOPICS.map(t=> <option key={t.id} value={t.id}>{t.ru} ‚Äî {t.de}</option>)}
              </select>

              <div className="mt-3">
                <label className="block text-sm text-gray-600">–í–∞—à–µ –∏–º—è</label>
                <input className="w-full p-2 mt-1 border rounded" value={senderName} onChange={e=>setSenderName(e.target.value)} />
              </div>

              <div className="mt-3">
                <label className="block text-sm text-gray-600">–ù–æ–º–µ—Ä —Å—á—ë—Ç–∞ / –∑–∞–∫–∞–∑–∞</label>
                <input className="w-full p-2 mt-1 border rounded" value={invoiceNumber} onChange={e=>setInvoiceNumber(e.target.value)} />
              </div>

              <div className="mt-4">
                <button onClick={()=>{
                  const newSel = Object.keys(PHRASES_DATA).reduce((acc,k)=>{
                    const items = PHRASES_DATA[k];
                    acc[k] = items[Math.floor(Math.random()*items.length)].id;
                    return acc;
                  },{});
                  setSelections(newSel);
                }} className="w-full bg-green-600 text-white py-2 rounded flex items-center justify-center">
                  <Icon.Refresh className="mr-2" /> –°–ª—É—á–∞–π–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è
                </button>
              </div>
            </div>

            <div className="card">
              <h3 className="text-lg font-semibold mb-2">2. –§—Ä–∞–∑—ã (Schreiben)</h3>
              <div className="space-y-3 max-h-96 overflow-y-auto pr-2">
                {Object.keys(PHRASES_DATA).map(key=>{
                  const labels = {
                    greetings:'1. –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ', issue_intro:'2. –í–≤–µ–¥–µ–Ω–∏–µ', main_problem:'3. –°—É—Ç—å', problem_consequence:'4. –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è',
                    evidence:'5. –î–æ–∫—É–º–µ–Ω—Ç—ã', resolution_request:'6. –ó–∞–ø—Ä–æ—Å', closing_formula:'7. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ', sign_off:'8. –ü–æ–¥–ø–∏—Å—å'
                  };
                  return (
                    <div key={key} className="mb-3">
                      <div className="text-sm font-semibold mb-2">{labels[key]}</div>
                      <div className="space-y-2">
                        {PHRASES_DATA[key].map(p=>{
                          const active = selections[key]===p.id;
                          return (
                            <div key={p.id} className={`p-3 rounded ${active ? 'bg-blue-50 border-2 border-blue-200' : 'bg-gray-50 border border-gray-100'} flex justify-between items-start`}>
                              <div>
                                <div className="font-medium">{replacePlaceholder(p.text)}</div>
                                <div className="text-sm italic text-gray-500 mt-1">{p.ru}</div>
                              </div>
                              <div className="ml-3 flex flex-col items-end">
                                <button className="btn-icon bg-white border p-1 mb-2" title="–í—ã–±—Ä–∞—Ç—å" onClick={()=> setSelections(prev=>({...prev,[key]: p.id}))}>
                                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.6"><path d="M20 6L9 17l-5-5"/></svg>
                                </button>
                                <button className="btn-icon bg-blue-600 text-white p-1" title="–û–∑–≤—É—á–∏—Ç—å (DE)" onClick={async ()=> { await unlockAudio(); await speakGerman(replacePlaceholder(p.text)); }}>
                                  {isLoading ? <Icon.Loader /> : <Icon.Volume />}
                                </button>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>

          {/* CENTER+RIGHT */}
          <div className="lg:col-span-2 space-y-6">
            <div className="card">
              <div className="flex justify-between items-center mb-4">
                <h2 className="text-xl font-bold">–ì–æ—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ</h2>
                <div className="text-sm text-gray-600">–î–∞—Ç–∞: {currentDate}</div>
              </div>

              <div className="bg-gray-50 p-4 rounded border border-gray-100 min-h-[200px] whitespace-pre-wrap text-gray-800">
                <pre className="m-0">{assembleLetter()}</pre>
              </div>

              <div className="mt-4 flex gap-3 items-center">
                <button className="px-4 py-2 bg-blue-700 text-white rounded" onClick={async ()=> { await unlockAudio(); await speakGerman(assembleLetter()); }}>
                  {isLoading ? <Icon.Loader className="mr-2" /> : <Icon.Volume className="mr-2" />} –û–∑–≤—É—á–∏—Ç—å –ø–∏—Å—å–º–æ (DE)
                </button>
                <button className="px-4 py-2 border rounded" onClick={()=> { navigator.clipboard.writeText(assembleLetter()); alert("–ü–∏—Å—å–º–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ"); }}>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                <a className="px-4 py-2 border rounded text-sm" href={"data:text/plain;charset=utf-8," + encodeURIComponent(assembleLetter())} download="letter.txt">–°–∫–∞—á–∞—Ç—å .txt</a>
              </div>
            </div>

            <div className="card">
              <div className="flex justify-between items-center mb-3">
                <h3 className="text-lg font-semibold">{activeScenario.title_ru} ‚Äî {activeScenario.title_de}</h3>
                <div>
                  <select value={activeScenario.id} onChange={(e)=>{
                    const s = SPRECHEN_SCENARIOS.find(x=>x.id===e.target.value);
                    setActiveScenario(s); setActiveDialogue(s.dialogues[0]);
                  }} className="p-2 border rounded">
                    {SPRECHEN_SCENARIOS.map(s=> <option key={s.id} value={s.id}>{s.title_ru}</option>)}
                  </select>
                </div>
              </div>

              <div className="mb-3">
                {activeScenario.dialogues.length > 1 && (
                  <div className="flex gap-2 mb-3">
                    {activeScenario.dialogues.map(d=> <button key={d.id} onClick={()=> setActiveDialogue(d)} className={`px-3 py-1 rounded ${activeDialogue.id===d.id ? 'bg-indigo-600 text-white' : 'bg-gray-100'}`}>{d.title_ru}</button>)}
                  </div>
                )}

                <div className="text-sm text-gray-700 mb-2">{activeDialogue.title_ru}</div>

                <div className="space-y-2 max-h-96 overflow-y-auto pr-2">
                  {parsedDialogue.map(line => (
                    <div key={line.id} className={`p-3 rounded ${line.speaker==='A:' ? 'bg-blue-50 border-blue-100' : 'bg-gray-50 border-gray-100'} flex justify-between items-start`}>
                      <div>
                        <div className="font-semibold"><span className="mr-2">{line.speaker}</span>{line.de_text}</div>
                        <div className="text-sm italic text-gray-600 mt-1">{line.ru_text}</div>
                      </div>
                      <div className="ml-3">
                        <button className="btn-icon bg-indigo-600 text-white p-1" onClick={async ()=> { await unlockAudio(); await speakGerman(line.de_text); }}>
                          {isLoading ? <Icon.Loader /> : <Icon.Volume />}
                        </button>
                      </div>
                    </div>
                  ))}
                </div>

                <div className="mt-4 text-sm text-gray-600">
                  üí° –°–æ–≤–µ—Ç: –≥–æ–≤–æ—Ä–∏ —Ç–æ–ª—å–∫–æ –ø–æ-–Ω–µ–º–µ—Ü–∫–∏ ‚Äî —Å–Ω–∞—á–∞–ª–∞ —Å–ª—É—à–∞–π, –∑–∞—Ç–µ–º –ø–æ–≤—Ç–æ—Ä—è–π –≤—Å–ª—É—Ö.
                </div>
              </div>
            </div>
          </div>
        </main>

        {showDebug && (
          <div className="card mt-4">
            <h3 className="text-lg font-semibold mb-2">–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–ª–æ–≥)</h3>
            <div className="debug-panel">
              {debug.length === 0 && <div className="text-gray-400">–õ–æ–≥ –ø—É—Å—Ç ‚Äî –Ω–∞–∂–º–∏—Ç–µ ¬´–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∑–≤—É–∫¬ª –∏ –∑–∞—Ç–µ–º ¬´–¢–µ—Å—Ç Premium¬ª</div>}
              {debug.map((d,i)=>(
                <div key={i} style={{color: d.type==='error' ? '#ff8a8a' : '#b7f5c6'}}><strong className="text-xs text-gray-400 mr-2">{d.t}</strong>{d.m}</div>
              ))}
            </div>
            <div className="mt-2 text-sm text-gray-600">
              –ï—Å–ª–∏ ElevenLabs –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç ‚Äî –≤—Å—Ç–∞–≤—å—Ç–µ –≤–∞–ª–∏–¥–Ω—ã–π –∫–ª—é—á –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é <code>ELEVEN.API_KEY</code> –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞ –∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É. –í Chrome –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞–∂–º–∏—Ç–µ ¬´–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∑–≤—É–∫¬ª –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º.
            </div>
          </div>
        )}

        <footer className="text-center text-xs text-gray-500 mt-8">
          –°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è ‚Äî v7 Stable. –û–∑–≤—É—á–∫–∞: ElevenLabs ‚Üí Web Speech (fallback). –¢–æ–ª—å–∫–æ –Ω–µ–º–µ—Ü–∫–∏–π –ø—Ä–∏ –æ–∑–≤—É—á–∫–µ.
        </footer>
      </div>
    );
  }

  ReactDOM.createRoot(document.getElementById('root')).render(<App/>);

  </script>
</body>
</html>
